{% extends "base.html" %}

{% block head %}
<link rel="stylesheet"
    href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,400,0,0" />
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>
<script type="text/javascript">
    $(document).ready(function () {
        var filters = {};
        $('input[type="checkbox"]').on('change', function () {
            $('input[type="checkbox"]:checked').each(function () {
                var filterName = $(this).attr('name');
                var filterValue = $(this).val();
                if (filters[filterName]) {
                    if(filters[filterName].indexOf(filterValue)==-1){
                        filters[filterName].push(filterValue);
                    }
                } else {
                    filters[filterName] = [filterValue];
                }
            });
            
            $.ajax({
                url: '/issues_table',
                data: JSON.stringify(filters),
                type: 'POST',
                contentType: 'application/json;charset=UTF-8',
                success: function (res) {
                    if (res.data.redirect) {
                        //window.location.href = res.data.redirect
                        window.history.pushState({}, "", res.data.redirect);
                        $('#issue-items').html(res.data.items);
                        console.log(res.data);
                    }
                }
            });
        });

        $('#search_text').keyup(function () {
            var search = $(this).val();
            filters = Object.assign({},filters,{ 'keyword' : [search] });
            $.ajax({
                url: "/issues_table",
                method: "POST",
                data: JSON.stringify(filters),
                contentType: 'application/json;charset=UTF-8',
                success: function (res) {
                    if (res.data.redirect) {
                        //window.location.href = res.data.redirect
                        window.history.pushState({}, "", res.data.redirect);
                        $('#issue-items').html(res.data.items);
                        console.log(res.data);
                    }
                }
            });
        });
    });
</script>
{% endblock %}

{% block content %}
<div class="container">
    <div class="container">{% include 'filters_bar.html' %}</div>
    <div class="container">
        <div class="container" id="issue-items">{% include 'issue_card.html'%}</div>
    </div>
</div>
{% endblock %}