{% extends "base.html" %}

{% block head %}
<link rel="stylesheet"
    href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,400,0,0" />
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>
<script type="text/javascript">
    $(document).ready(function () {
        $('input[type="checkbox"]').on('change', function () {
            var filters = {};
            $('input[type="checkbox"]:checked').each(function () {
                var filterName = $(this).attr('name');
                var filterValue = $(this).val();
                if (filters[filterName]) {
                    filters[filterName].push(filterValue);
                } else {
                    filters[filterName] = [filterValue];
                }
            });
            $.ajax({
                url: '/filter',
                data: JSON.stringify(filters),
                type: 'POST',
                contentType: 'application/json;charset=UTF-8',
                success: function (response) {
                    console.log(response);
                    $('#issue-items').html(response.data.items);
                    if (res.data.redirect) {
                        window.history.pushState({}, "", res.data.redirect);
                    }
                }
            });
        });

        $('#search_text').keyup(function () {
            var search = $(this).val();
            $.ajax({
                url: "/issues_table",
                method: "POST",
                data: { search_for: search },
                success: function (res) {
                    $('#search_text').html(res.data.search_for)
                    $('#issue-items').html(res.data.items)
                    if (res.data.redirect) {
                        window.history.pushState({}, "", res.data.redirect);
                    }
                }
            });
        });
    });
</script>
{% endblock %}

{% block content %}
<div class="container">
    <div class="container">{% include 'filters_bar.html' %}</div>
    <div class="container">
        <div class="container" id="issue-items">{% include 'issue_card.html'%}</div>
    </div>
</div>
{% endblock %}